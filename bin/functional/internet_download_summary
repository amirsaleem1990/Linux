#!/bin/bash

# read -p "Enter file extention(eg: mp4, mp4 is default):  " extention
if [[ $extention = "" ]]; then
	extention=mp4 
fi

SUM=`du -sh -BM | sed 's/M..//g'`

IFS=$'\n'
before_files=`ls | grep -v 'part$' | grep -v 'ytdl$' | wc -l`

c=0
while :; do
	current=`du -sh -BM | sed 's/M..//g'`
	incremental=$(( $current - $SUM ))
	SUM=$current
	# m=0
	# for i in `ls`; do
	# 	[[ ${before_files[*]} =~ $i ]] && m=yes || m=no
	# 	if [[ $m == "no" ]]; then
	# 		let "m++"
	# 	fi
	# done
	# echo "Time: `date +%H:%M` | IncremenalSize: $incremental | FullSize: $SUM | filesQty.: `find . -name "*.$extention" | wc -l `"
	# new_filesQty=$(for i in `ls`; do 
		# [[ ${before_files[*]} =~ $i ]] && echo yes || echo no
	# done | grep no | grep -v 'part$' | grep -v 'ytdl$' | wc -l)
	after_files=`ls | grep -v 'part$' | grep -v 'ytdl$' | wc -l`
	# if [[ $c == 0 ]] ; then
	echo "Time,IncremenalSize,FullSize,IncremenalFilesQty,AllFilesQty" > /home/amir/._amb
	echo "`date +%H:%M`,$incremental,$SUM,$(( $after_files - $before_files )),$after_files" >> /home/amir/._amb
	# else
		# echo "`date +%H:%M`,$incremental,$SUM,$(( $after_files - $before_files )),$after_files" > /home/amir/._amb
	# fi
	let "c++"
	if [[ $c == 1 ]]; then
		cat /home/amir/._amb | column -t -s, | grep --color "\|Time\|IncremenalSize\|FullSize\|IncremenalFilesQty\|AllFilesQty"
	else
		cat /home/amir/._amb | column -t -s, | tail -1
	fi
	if [[ $c == 15 ]]; then
		c=0
	fi
	# sleep 1m
	sleep 1s
done