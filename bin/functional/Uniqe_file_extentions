#!/bin/bash
rm -f ~/.xm2
IFS=$'\n'
parameter=$1
echo -e "\n"
if [[ -z "$parameter" ]] ;	then  # if parameter not passed
	echo "-----------------------------------------------------"
	echo -e "Parameter not passed\n\t1- Only current direcotory\n\t2- Current and all subdirectories\nSo default (1) used"
	echo -e "-----------------------------------------------------\n\n"
	parameter=1
fi

if [[ $parameter -eq 1 ]] ; then
	echo "`ls -d */ | wc -l` ----Folders----"
	echo -e "\n"
	ls -p |\
		grep -v /  |\
		grep '\.' |\
		rev |\
		cut -d. -f1 |\
		rev |\
		sort |\
		uniq -c |\
		sed 's/\ \{2,\}//g'

else
	# tree |\
	# 	rev |\
	# 	grep  '\.'|\
	# 	cut -d. -f1 |\
	# 	rev |\
	# 	sed /─/d |\
	# 	sed /^$/d |\
	# 	# sed '$ d' |\
	# 	sort |\
	# 	uniq -c |\
	# 	sed 's/^ \{1,\}//g' |\
	# 	column -t 
	for extention in `tree | rev | grep  '\.'| cut -d. -f1 | rev | sed /─/d | sed /^$/d | sort | uniq`; do
		echo -n  "$extention," >> ~/.xm2
		for file in `find . -name "*$extention"`; do
			du -s -BK $file 2>/dev/null | cut -d 'K' -f1 
		done | paste -sd+ | bc > ~/.xm1
		f=$( echo `cat ~/.xm1` / 1024 | bc )
		echo "$f,`find . -name "*$extention" | wc -l`" >> ~/.xm2
	done
	echo -e "Extention,Size(MB),Qty\n---------,--------,---\n`cat ~/.xm2 | tail -n+2 | sort -k3 -nr -t, `" | column -t -s,
	# cat ~/.xm2 | column -t -s,
fi



# #---------------------------------------------------------------------
# # rm ~/ab.txt
# # a=`ls | cut -d "_" -f1 | wc -l`
# # for i in `ls | cut -d "_" -f1 | head -$(( $a -1))` ; do
# # 	cd $i*
# # 	for f in *.*; do printf "%s\n" "${f##*.}" | sort -u ; done | sort -u  >> ~/ab.txt
# # 	cd ../
# # done
# # cat ~/ab.txt | sort -u
# #---------------------------------------------------------------------
