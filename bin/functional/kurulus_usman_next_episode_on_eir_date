#!/usr/bin/ipython3
# #!/home/amir/.local/bin/ipython3
from termcolor import colored
from tabulate import tabulate
import pandas as pd
import requests
from bs4 import BeautifulSoup
url = "https://next-episode.net/kurulus-osman"
soup = BeautifulSoup(requests.get(url).text, "lxml")
l = [i.strip() for i in soup.find("div", {"id": "next_episode"}).text.split("\n")[3:] if i][:-1]
d = {}
for i in l:
	a = i.split(":")
	d[a[0]] = a[1]
df = pd.DataFrame(d, index=["info"]).T

comming_episode_number = int(df.iloc[-1][0])

print(tabulate(df))
print("\n\nhttps://ardirilisertugrul.net/Kurulus-Osman/home.php\n")

last_vid = f"https://ardirilisertugrul.net/Kurulus-Osman/1.php?id={26 + int(d['Name'].split()[-1])}"
print("Last video page:", last_vid)

s = BeautifulSoup(requests.get(last_vid).text, "lxml")
for i in s.select("li"):
	try:
		l = i['data-source']
		if "videoembed" in l:
			if not l.startswith("https:"):
				l = "https:" + l
			l = l.strip()
			print("Last video Download/watch link:", l)
			break
	except:
		pass

s = BeautifulSoup(requests.get(l).text, "lxml")
print("Last video Duration:", s.find("div", {"class" : "vid-card_duration"}).text)


last_video_downloaded = int(open("/home/amir/.kurulus_usman_last_downloaded.txt", "r").read().strip())


# f = """\n\n#############################################################
# ####-----------------{} -------------------####
# #############################################################\n"""
# 
# if comming_episode_number - last_video_downloaded == 1:
# 	print(f.format("--- NO NEW VIDEO"))
# elif comming_episode_number - last_video_downloaded > 1:
# 	print(colored(f.format(" CONGRATULATIONS"))

print("""\n\n#############################################################
####-----------------""", end="")
g = False
if comming_episode_number - last_video_downloaded == 1:
	print(colored("--- NO NEW VIDEO", 'red'), end="")
elif comming_episode_number - last_video_downloaded > 1:
	g = True
	print(colored(" CONGRATULATIONS", 'red'), end="")

print(""" -------------------####
#############################################################\n""")


print("\nLast video downloaded was:", last_video_downloaded)


print("""
####################################################
# agar video download kar len to                   #
# </home/amir/.kurulus_usman_last_downloaded.txt>  #
# file ko update kar den                           #
####################################################
\n""")


if g:
	ans_ = input("\n\nAre you need to update /home/amir/.kurulus_usman_last_downloaded.txt file?\n[y|n]  ")
	if ans_ == "y":
		ans_ = input("Enter last episode you downloaded/watched to enter in /home/amir/.kurulus_usman_last_downloaded.txt: ")
		open("/home/amir/.kurulus_usman_last_downloaded.txt", 'w').write(ans_)
print()