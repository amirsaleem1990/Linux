#!/bin/bash

RED="\033[0;31m"
normal="\033[0m"

Wh=$(upower -d | grep 'energy-full:' | head -n1 | cut -d: -f2 | sed 's/^\ \{1,\}//g' | cut -d' ' -f1)
V=$(upower -d | grep voltage | cut -d: -f2 | sed 's/^\ \{1,\}//g' | cut -d' ' -f1)
mah=$(echo "scale=0; $Wh*1000/$V" | bc -l)

upower -d /org/freedesktop/UPower/devices/battery_BAT0 | grep "energy:\|voltage\|energy-full:\|energy-full-design:\|energy-rate:\|capacity:\|TimeToEmpty:\|time to full:\|time to empty:" | sed 's/^    //g' | sort -u
echo "Mah:                 $mah Mah"
echo -e "\n\n--------------------------\n\n"
upower -i /org/freedesktop/UPower/devices/battery_BAT0| grep -E "state|to\ full|percentage" | sed 's/^    //g'


echo -e  "$(upower -d  | grep -E "energy:|voltage|energy-full:|energy-full-design:|energy-rate:|capacity:|TimeToEmpty:|time to full:|time to empty:|state|to\ full|percentage" | sort -u | sed 's/^    //g' | sed 's/:\ \{1,\}/,/g')\nDate,$(date +%D-%T)" | cut -d, -f2  | paste -sd "," >> /home/amir/github/Amir-personal/battery_record.csv

echo -e "

${RED}Energy     :${normal} Amount of energy (measured in Wh) currently available in the power source.
${RED}EnergyFull :${normal} Amount of energy (measured in Wh) in the power source when it's considered full.
${RED}EnergyRate :${normal} Amount of energy being drained from the source, measured in W. If positive, the source is being discharged, if negative it's being charged.
${RED}TimeToEmpty:${normal} Number of seconds until the power source is considered empty.
${RED}TimeToFull :${normal} Number of seconds until the power source is considered full.
"

# echo key,value > /home/amir/.battery_1
# upower -d /org/freedesktop/UPower/devices/battery_BAT0 | grep "energy:\|energy-full:\|energy-full-design:\|energy-rate:\|capacity:\|TimeToEmpty:\|time to full:\|time to empty:" | sed 's/^    //g' | sort -u | sed 's/:\ \{1,\}/,/g' >> /home/amir/.battery_1
# echo -e "\n\n"
# python3 <<< '
# import pandas as pd
# print(
# 	(
# 	"\n"
# 	.join(pd.read_csv("/home/amir/.battery_1").merge(pd.read_csv("/home/amir/github/Amir-personal/.battery_2"), on="key", how="left")
# 		.apply(lambda x:":".join(x.dropna().astype(str).to_list()), axis=1)
# 		.to_list()
# 		)
# 	)
# 	)
# ' | column -t -s:


# echo -e "\n\n--------------------------\n\n"
# upower -i /org/freedesktop/UPower/devices/battery_BAT0| grep -E "state|to\ full|percentage" | sed 's/^    //g'

# echo -e "\n\n"