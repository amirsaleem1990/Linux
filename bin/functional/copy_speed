#!/bin/bash

convertsecs() {
 ((h=${1}/3600))
 ((m=(${1}%3600)/60))
 ((s=${1}%60))
 printf "%02d:%02d:%02d\n" $h $m $s
}
IFS=$'\n'
if [[ $1 == "" ]] ; then
	read -e -p "Enter your File /Folder absolute path: " all_data_in_MB
else
	all_data_in_MB=$1
fi

if [[ $2 == "" ]]; then
	read -p "Enter sleep time (in seconds) [default is 60 seconds]: " sleep_time
else
	sleep_time=$2
fi

if [[ $sleep_time = "" ]] ; then
	sleep_time=60
fi

# all_data_in_MB=/media/500GB/320GB
m=$(du -s $all_data_in_MB -BM)
# m='42384M	/home/amir/g'

m1=${m%[[:space:]]*}
all_data_in_MB=$(echo $m1 | tr -dc '0-9')

last=$(echo $(du -s -BM) | tr -dc '0-9')
Average_array=()


while :
	do 
	current=$(echo $(du -s -BM) | tr -dc '0-9')
	echo -n "TOTAL: $(du -sh | sed 's/[\t,.]//g ') | in last $sleep_time Secs: "
	echo -n `expr $current - $last ` MB \| `   date +%H:%M:%S`
	completed=$(echo "scale=2; $current/$all_data_in_MB" | bc)
	completed=$(echo $completed | tr -dc '0-9')
	echo -n " | " Completed $completed %
	curent_time=`date +%s`
	average_speed=$(echo `expr $current - $last `)
	Average_array+=("$average_speed")
	SUM=0
	for i in ${Average_array[@]}
	do
	  SUM=$(echo `expr $SUM + $i`)
	done

	LEN_OF_Average_array=$(echo "${#Average_array[@]}")
	mean=$(echo "scale=3; $SUM/$LEN_OF_Average_array" | bc)
	
	last=$current
	ab=$(echo "scale=2; 100/$completed" | bc)
	
	Estimated_time=$(echo "$ab*$mean*$sleep_time" | bc)
	Estimated_time=${Estimated_time%.*}
	echo " | Remaining time: `convertsecs $Estimated_time`"
	sleep $sleep_time
done
