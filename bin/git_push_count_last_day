#! /bin/bash
read -p "Enter Days (eg: 1): " day
read -p "Are you need Plot? [y\n]: " plot
echo "Count,Repo" > ~/git_counts.csv
cd /home/amir/github
for git_folder in $(ls -d */);
	do  
	cd $git_folder
	count=$(git rev-list HEAD --count --first-parent --since=$(date --date=$day" day ago" +%F))
	echo $count,$git_folder >> ~/git_counts.csv
	cd ../
	done


if [ $plot == 'n' ]
	then
		python3 -c 'import pandas as pd; df=pd.read_csv("~/git_counts.csv"); import pprint; df = df[df.Count > 0].sort_values("Count", ascending=False).reset_index().drop("index", axis=1); pprint.pprint(df); print(f"\n****  Total count: {df.Count.sum()} ****\n"); '
	else
		python3 -c 'import pandas as pd; df=pd.read_csv("~/git_counts.csv"); import pprint; df = df[df.Count > 0].sort_values("Count", ascending=False).reset_index().drop("index", axis=1); pprint.pprint(df); print(f"\n****  Total count: {df.Count.sum()} ****\n"); import matplotlib.pyplot as plt; plt.bar(df.Repo, df.Count); plt.show()'
fi


rm ~/git_counts.csv
